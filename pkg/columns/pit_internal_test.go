package columns

import (
	"reflect"
	"testing"
)

func TestMarkLinesToRemove(t *testing.T) {
	p := NewPit(13, 6)
	p.Cells = [][]int{
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 1, 0, 0, 1, 0},
		{1, 1, 1, 1, 1, 1},
		{1, 1, 0, 1, 1, 1},
	}
	expected := [][]int{
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, -1, 0, 0, -1, 0},
		{-1, -1, -1, -1, -1, -1},
		{1, -1, 0, -1, -1, -1},
	}
	p.markTilesToRemove()
	if !reflect.DeepEqual(p.Cells, expected) {
		t.Errorf("Expected %v, got %v", expected, p.Cells)
	}
}

func TestMarkLinesToRemoveDiagonal(t *testing.T) {
	p := NewPit(13, 6)
	p.Cells = [][]int{
		{1, 0, 0, 0, 0, 1},
		{0, 1, 0, 0, 1, 0},
		{0, 0, 1, 1, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{1, 0, 0, 0, 0, 1},
		{0, 1, 0, 0, 1, 0},
		{0, 0, 1, 1, 0, 0},
	}
	expected := [][]int{
		{-1, 0, 0, 0, 0, -1},
		{0, -1, 0, 0, -1, 0},
		{0, 0, -1, -1, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{-1, 0, 0, 0, 0, -1},
		{0, -1, 0, 0, -1, 0},
		{0, 0, -1, -1, 0, 0},
	}
	p.markTilesToRemove()
	if !reflect.DeepEqual(p.Cells, expected) {
		t.Errorf("Expected %v, got %v", expected, p.Cells)
	}
}
func TestSettle(t *testing.T) {
	p := NewPit(13, 6)
	p.Cells = [][]int{
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 1, 2, 0, 0, 0},
		{-1, -1, -1, 0, 0, 1},
		{1, 2, 3, 1, 4, 1},
	}
	expected := [][]int{
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0},
		{0, 1, 2, 0, 0, 1},
		{1, 2, 3, 1, 4, 1},
	}
	p.settle()
	if !reflect.DeepEqual(p.Cells, expected) {
		t.Errorf("Expected %v, got %v", expected, p.Cells)
	}
}
